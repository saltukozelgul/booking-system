<!DOCTYPE html>
{% load static %}
{% load custom_filters %}
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Moviote</title>
        <link rel="icon" type="image/x-icon" href="{% static 'assets/favicon.png' %}" />
        <!-- Fontawesome-->
        <script src="https://kit.fontawesome.com/852539a4c9.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link rel="preconnect" href="https://fonts.gstatic.com" />
        <link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,wght@0,600;1,600&amp;display=swap" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=Mulish:ital,wght@0,300;0,500;0,600;0,700;1,300;1,500;1,600;1,700&amp;display=swap" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,400;1,400&amp;display=swap" rel="stylesheet" />
        <script
        src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
        crossorigin="anonymous"></script>
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="{% static 'css/styles.css' %}" rel="stylesheet" />
        <link href="{% static 'css/hover.css' %}" rel="stylesheet" />
        <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
        <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light fixed-top shadow-sm" id="mainNav">
            <div class="container px-4">
                <a class="navbar-brand fw-bold" href="{% url 'main' %}">
                    Güsto Etkinlik Kayıt Sistemi
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fa-solid fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto me-4 my-3 my-lg-0">
                        <button class="btn text-white bg-gradient-primary-to-secondary rounded-pill px-3 mb-2 mb-lg-0 hvr-sink">
                            <a href="{% url 'choose' %}">
                                <span class="d-flex align-items-center">
                                    <span class="small">Tüm etkinlikler</span>
                                </span>
                            </a>
                        </button>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Mashead header-->
        <section id="features">
            <div class="container mt-2">
                <div class="row align-items-center">
                    <div class="col-lg-12 order-lg-1 mb-5 mb-lg-0">
                        <div class="container-fluid">
                            <div class="row">
                                {% if id == "1" %}
                                <div class="col-md-6 mb-5">
                                    <!-- Feature item-->
                                    <div class="text-center">
                                        <img class="mb-2" src="{% static 'assets/svgs/etkinlik-1.svg' %}" style="width:100%;height:300px">
                                        <h3 class="font-alt">Tanışma Partisi</h3>
                                        <p class="text-muted mb-0">Sosyalleşip sinema hakkında konuşup sohbet edebileceğin tanışma partisi!</p>
                                        <p>9 Ekim 2022 - Pazar</p>
                                        <h5 class="font-alt"> <span id="user-count">{{ users|length }}</span>/100</h5>
                                    </div>
                                </div>
                                {% elif id == "2" %}
                                <div class="col-md-6 mb-5">
                                    <!-- Feature item-->
                                    <div class="text-center">
                                        <img  class="mb-2" src="{% static 'assets/svgs/etkinlik-2.svg' %}" style="width:100%;height:300px">
                                        <h3 class="font-alt">Film Gösterimleri</h3>
                                        <p class="text-muted mb-0">Okulumuzun kütüphanesinde bulunan sinema salonunda film izlemeye davetlisin.</p>
                                        <p>Her pazartesi ve cuma - 14.00</p>
                                        <h5 class="font-alt"> <span id="user-count">{{ users|length }}</span>/100</h5>
                                    </div>
                                </div>
                                {% elif id == "3" %}
                                <div class="col-md-6 mb-5">
                                    <!-- Feature item-->
                                    <div class="text-center">
                                        <img  class="mb-2" src="{% static 'assets/svgs/etkinlik-2.svg' %}" style="width:100%;height:300px">
                                        <h3 class="font-alt">Online İzleme Etkinlikleri</h3>
                                        <p class="text-muted mb-0">Bu etkinlikler discord sunucumuzda.</p>
                                        <p class="text-muted mb-0">(Bu etkinliklerin kontejyan sınırı yoktur)</p>
                                        <p>Her pazartesi ve cuma - 14.00</p>
                                    </div>
                                </div>
                                {% else %}
                                {% endif %}
                                <div class="col-md-6 mb-5">
                                    <div class="screen">
                                        <div class="screen-header">
                                        <div class="screen-header-left">
                                            <div class="screen-header-button close"></div>
                                            <div class="screen-header-button maximize"></div>
                                            <div class="screen-header-button minimize"></div>
                                        </div>
                                        <div class="screen-header-right">
                                            <div class="screen-header-ellipsis"></div>
                                            <div class="screen-header-ellipsis"></div>
                                            <div class="screen-header-ellipsis"></div>
                                        </div>
                                        </div>
                                        <div class="screen-body">
                                        <div class="screen-body-item left">
                                            <div class="app-title">
                                            <span>Etkinliğe kaydol</span>
                                            </div>
                                            <div class="app-contact text-white"></div>
                                        </div>
                                        <div class="screen-body-item" style="padding-left:0">
                                            <div class="app-form">
                                                <form action="" method="post">
                                                    {% csrf_token %}
                                                    <div class="app-form-group">
                                                        <input class="app-form-control" name="name" placeholder="İsminiz">
                                                    </div>
                                                    <div class="app-form-group">
                                                        <input class="app-form-control" name="email" placeholder="Email Adresiniz">
                                                    </div>
                                                    <div class="app-form-group">
                                                        <input class="app-form-control" name="phone" placeholder="Telefon">
                                                        <p style="font-size:small;color:#666" class="mt-3">Numaranızı başında 0 olmayacak (5051234567) şekilde giriniz.</p>
                                                    </div>
                                                    <div class="app-form-group buttons">
                                                        <button class="app-form-button mt-3">Kayıt ol!</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        </div>
                                    </div>
                                    <div class="messages text-center  mt-3">
                                        {% for message in messages %}
                                        <p class="mb-0 msg-{% if message.level == 40 %}error{% else %}succes{% endif %}">
                                            {{message}}
                                        </p>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="table-responsive">
                    <h3 class="text-center">Kayıtlı Listesi</h3>
                    <table class="table table-striped" style="padding:2%">
                        <thead>
                          <tr>
                            <th scope="col">#</th>
                            <th scope="col">Adı</th>
                            <th scope="col">Email adresi</th>
                            <th scope="col">Numara</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for user in users %}
                          <tr>
                            <th scope="row">{{forloop.counter}}</th>
                            <td>{{user.name}}</td>
                            <td>{{user.email|hideemail}}</td>
                            <td>{{user.phone|hidephone}}</td>
                            <td>
                                <a class="delete" style="cursor:cell">
                                    <i class="fas fa-trash" style="color:#9386CC"></i>
                                    <p hidden>{{forloop.counter}}</p>
                                </a>
                            </td>
                          </tr>
                          {% endfor %}
                        </tbody>
                </table>
                </div>
            </div>
        </section>
        <!-- Footer-->
        <footer class="bg-black text-center py-5">
            <div class="container px-5">
                <div class="text-white-50 small">
                    <div class="mb-2">&copy; GÜSTO 2022. Tüm Hakları Saklıdır.</div>
                    <div>
                    </div>
                    <a href="https://saltukozelgul.github.io/">Saltware Design</a>
                </div>
            </div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script>
            AOS.init();
        </script>

<script>
	$('.delete').click(function(event){
		// preventing default actions
		event.preventDefault();
		var page_no = $(this).attr('href');
		// ajax call
        $.ajax({
					type: "POST",
					// define url name
					url: "{% url 'delete' %}", 
					data : {    
					number : prompt("Silinmesi istediğiniz randevunun numarasını giriniz:", ""),
                    id : '{{id}}',
					csrfmiddlewaretoken: '{{ csrf_token }}',
				},
				// handle a successful response
				success: function (response) {
                    if (response.status == "not found") {
                        alert("Bu numaraya sahip bir kayıt bulunamadı.")
                    }
                    if (response.status == "deleted") {
                        console.log("deleted")
                        newValue = +$('#user-count').text() - 1
                        $("#user-count").text(newValue)
                        console.log(event.target.closest('tr').innerHTML = '')
                    }
				},
				error: function () {
					console.log("hata oluştu")
				}
			}); 
	});    
	</script>
    </body>
</html>
